<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>ITC230-Hotels</title>
    </head>
    <body>

        <div id='root'></div>
        <script type="text/babel">
            class HotelApp extends React.Component {
                constructor(props) {
                    super(props);
                    this.state = {
                        hotels: {{{hotels}}},
                        currItem: {},
                        filter: ""
                   };

                   this.onSearchChange = this.onSearchChange.bind(this);
                   this.clickItem = this.clickItem.bind(this);
                   this.onEditorChange = this.onEditorChange.bind(this);
               };


                render() {
                    return (
                        <div>
                            <Title title="Hotel Options" />
                            <ItemList items={this.state.hotels}
                                filterProp={this.state.filter}
                                clickProp={this.clickItem}/>
                            <SearchForm filterProp={this.state.filter}
                                changeProp={this.onSearchChange}/>
                            <SearchMirror filterPropMirror={this.state.filter}/>
                            <ItemEditor item={this.state.currItem}
                                changeProp={this.onEditorChange}/>


                        </div>

                    );
                }

                onEditorChange(event) {
                    let hotel = this.state.currItem;
                    hotel[event.target.key] = event.target.value;
                    this.setState({currItem: hotel});
                }

                onSearchChange(event) {
                    this.setState({filter: event.target.value.toLowerCase() });
                }

                clickItem(event) {
                    console.log("id clicked: " + event.target.id);
                    let itemToShow = this.state.hotels.find((hotel) => {
                        return (hotel._id == event.target.id);
                    });
                    this.setState({currItem: itemToShow});
                }
            }

            const SearchForm = (props) => {
                return (
                    <div>
                        <label>Search for a hotel:</label>
                        <input name="searchNameInput" type="text"
                            value={props.filterProp}
                            onChange={props.changeProp}
                        />
                    </div>);
            };

            const Title = ({title}) => {
                return (
                   <div><h2>{title}</h2></div>
                );
            }
            const SearchMirror = (props) => {
                return <div><h3>You are currently searching for: {props.filterPropMirror}</h3></div>;
            }

            const ItemList = (props) => {
                const itemNodes = props.items.map((item) => {
                    if (item.name.toLowerCase().indexOf(props.filterProp) >= 0)
                        return <li key={item._id} id={item._id} onClick={props.clickProp}>{item.name}</li>;
                });
                return <ul>{itemNodes}</ul>;
            };

            const ItemEditor = (props) => {
                let hotel = props.item;
                return (<div>
                    <h3>Current Item</h3>
                    <form>
                        <input type="text" key="name" value={hotel.name}/>
                        <input type="text" key="address" value={hotel.address}/>
                        <input type="checkbox" key="luxury" value={hotel.luxuryFlag}/>
                    </form>
                    </div>);
            };



            ReactDOM.render(<HotelApp/>, document.getElementById('root'));
        </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react-dom.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    </body>
</html>
